<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì»´í“¨í„°ì‹¤ ëª°ë˜ ê²Œì„: ì„ ìƒë‹˜ì˜ ëˆˆ V11</title>
    <link href="https://fonts.googleapis.com/css2?family=DungGeunMo&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #00ff00; font-family: 'DungGeunMo', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #header { width: 100%; padding: 10px; background: #222; display: flex; flex-direction: column; align-items: center; border-bottom: 4px inset #555; z-index: 100; }
        .time-container { width: 90%; height: 15px; background: #111; border: 2px inset #555; margin: 5px 0; overflow: hidden; }
        #time-bar { width: 100%; height: 100%; background: #00ff00; transition: width 0.1s linear; }

        #game-grid { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; width: 100vw; height: 85vh; gap: 15px; padding: 20px; box-sizing: border-box; }
        
        /* ëª¨ë‹ˆí„° ë° ì„ ìƒë‹˜ ë ˆì´ì•„ì›ƒ */
        .monitor-container { position: relative; display: flex; flex-direction: column; align-items: center; transition: all 0.6s; }
        .teacher-box { 
            width: 80px; height: 80px; font-size: 3rem; display: flex; justify-content: center; align-items: center;
            background: #444; border: 4px solid #777; border-radius: 10px 10px 0 0; margin-bottom: -4px; transition: background 0.2s;
        }
        /* ì„ ìƒë‹˜ì´ í•™ìƒì„ ë³¼ ë•Œ (ìœ„í—˜) */
        .teacher-box.watching { background: #ff0000; border-color: #fff; animation: shake 0.1s infinite; }

        .monitor { width: 100%; position: relative; border: 8px outset #aaa; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px; }
        .red-mon { border-color: #e74c3c; }
        .blue-mon { border-color: #3498db; }

        .board { display: grid; grid-template-columns: repeat(8, 1fr); gap: 3px; }
        .card { width: 45px; height: 25px; background: #333; color: #666; font-size: 0.55rem; display: flex; justify-content: center; align-items: center; border-radius: 2px; }
        .card.red { background: #e74c3c; color: white; }
        .card.blue { background: #3498db; color: white; }

        .input-wrap { margin-top: 10px; width: 90%; }
        input { width: 100%; padding: 8px; font-family: 'DungGeunMo'; background: #000; color: #0ff; border: 2px solid #0ff; outline: none; text-align: center; }

        /* ë³´ë„ˆìŠ¤ ëª¨ë‹¬ */
        #bonus-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70%; background: #000; border: 5px solid #f1c40f; padding: 40px; display: none; flex-direction: column; align-items: center; z-index: 2000; }
        
        @keyframes shake { 0% { transform: rotate(2deg); } 100% { transform: rotate(-2deg); } }
    </style>
</head>
<body>

<div id="header">
    <div id="timer-text">ì»µë–¡ë³¶ì´ ë‚´ê¸° ì¢…ë£Œê¹Œì§€: 40.0s</div>
    <div class="time-container"><div id="time-bar"></div></div>
    <div style="font-size: 0.8rem; color: #ffeb3b;">ì„ ìƒë‹˜ì´ ë’¤ëŒì•„ì„œ ìš°ë¦¬ë¥¼ ë³¼ ë•Œ(ë¹¨ê°„ ë°°ê²½)ëŠ” ì…ë ¥ ê¸ˆì§€!</div>
</div>

<div id="bonus-modal">
    <div style="color: #f1c40f; font-size: 1.2rem; margin-bottom: 15px;">âš¡ ë§ˆì§€ë§‰ íƒ€ì ê²€ì • âš¡</div>
    <div id="bonus-q" style="font-size: 1.5rem; margin-bottom: 20px; text-align: center; color: #fff;"></div>
    <input type="text" id="bonus-in" style="font-size: 1.5rem; width: 90%; border: 3px solid #f1c40f;">
</div>

<div id="game-grid">
    <div id="cont-1" class="monitor-container" style="order:1;">
        <div id="t-1" class="teacher-box">ğŸ‘¨â€ğŸ«</div>
        <div id="mon-1" class="monitor red-mon"><div class="board" id="b-1"></div><div class="input-wrap"><input type="text" id="in-1" placeholder="RED 1" onfocus="lastTeam='red'"></div></div>
    </div>
    <div id="cont-2" class="monitor-container" style="order:2;">
        <div id="t-2" class="teacher-box">ğŸ‘¨â€ğŸ«</div>
        <div id="mon-2" class="monitor blue-mon"><div class="board" id="b-2"></div><div class="input-wrap"><input type="text" id="in-2" placeholder="BLUE 1" onfocus="lastTeam='blue'"></div></div>
    </div>
    <div id="cont-3" class="monitor-container" style="order:3;">
        <div id="t-3" class="teacher-box">ğŸ‘¨â€ğŸ«</div>
        <div id="mon-3" class="monitor red-mon"><div class="board" id="b-3"></div><div class="input-wrap"><input type="text" id="in-3" placeholder="RED 2" onfocus="lastTeam='red'"></div></div>
    </div>
    <div id="cont-4" class="monitor-container" style="order:4;">
        <div id="t-4" class="teacher-box">ğŸ‘¨â€ğŸ«</div>
        <div id="mon-4" class="monitor blue-mon"><div class="board" id="b-4"></div><div class="input-wrap"><input type="text" id="in-4" placeholder="BLUE 2" onfocus="lastTeam='blue'"></div></div>
    </div>
</div>

<script>
    const catWords = ["ê³ ì–‘ì´", "ì•¼ì˜¹ì´", "ì¸„ë¥´", "ì ¤ë¦¬", "ê¾¹ê¾¹ì´", "ê³¨ê³¨ì†¡", "ì§‘ì‚¬", "ëª¨ë˜", "ì‚¬ë£Œ", "ìº£íƒ€ì›Œ", "ìˆ˜ì—¼", "ê·¸ë£¨ë°", "ëƒ¥ëƒ¥í€ì¹˜", "ê¼¬ë¦¬", "ë‚®ì ", "í–‡ì‚´", "ìŠ¤í¬ë˜ì³", "ìº£ì", "ë°©ìš¸", "ì‚¼ìƒ‰ì´", "ì¹˜ì¦ˆ", "ê³ ë“±ì–´", "ìƒ´", "ëŸ¬ë¸”", "ë§í† ", "ë°œë°”ë‹¥", "í•˜ì•…ì§ˆ", "ê°œëƒ¥ì´", "ì‚¬ëƒ¥", "ìƒì„ ", "ìš°ìœ ", "ë°•ìŠ¤", "ë‚šì‹œ", "ë¬´ë¦ëƒ¥", "í„¸ê³µ", "í„¸ê°ˆì´", "í•˜í’ˆ", "ì°½ë°–", "ìˆ¨ë°”ê¼­ì§ˆ", "ì½”ì¸ì‚¬"];
    const bonusSentences = ["ì˜¤ëŠ˜ í•™êµ ëë‚˜ê³  ì •ë¬¸ ì• ì»µë–¡ë³¶ì´ ì½œ?", "ì„ ìƒë‹˜ ë’¤ëŒì•„ ìˆì„ ë•Œ ëª°ë˜ í•˜ëŠ” ê²Œì„ì´ ì œì¼ ê¿€ì¼"];

    let timeLeft = 400;
    let isBonus = false;
    let isTeacherWatching = false; // ì„ ìƒë‹˜ì´ í•™ìƒì„ ë³´ëŠ” ìƒíƒœ
    let lastTeam = 'red';
    let teamLog = { red: [], blue: [] };

    function init() {
        for(let i=1; i<=4; i++) {
            const b = document.getElementById(`b-${i}`);
            catWords.forEach(w => {
                const c = document.createElement('div');
                c.className = 'card'; c.innerText = w; c.id = `c-${i}-${w}`;
                b.appendChild(c);
            });
            setupInput(i);
        }
        setupBonus();
        startTimers();
        scheduleTeacher();
    }

    function startTimers() {
        setInterval(() => {
            timeLeft--;
            document.getElementById('time-bar').style.width = (timeLeft/400)*100 + "%";
            document.getElementById('timer-text').innerText = isBonus ? "ë³´ë„ˆìŠ¤ íƒ€ì„!" : `ì»µë–¡ë³¶ì´ ë‚´ê¸° ì¢…ë£Œê¹Œì§€: ${(timeLeft/10).toFixed(1)}s`;
            if(timeLeft <= 0) {
                if(!isBonus) startBonus();
                else finishGame();
            }
        }, 100);

        setInterval(() => {
            if(!isBonus && !isTeacherWatching) {
                let orders = [1,2,3,4].sort(()=>Math.random()-0.5);
                for(let i=1; i<=4; i++) document.getElementById(`cont-${i}`).style.order = orders[i-1];
            }
        }, 10000);
    }

    // ì„ ìƒë‹˜ ê°ì‹œ ë¡œì§ (20ì´ˆë§ˆë‹¤ 2ì´ˆê°„ ê°ì‹œ)
    function scheduleTeacher() {
        setTimeout(() => {
            if(!isBonus) {
                isTeacherWatching = true;
                // ëª¨ë“  ì„ ìƒë‹˜ ë°•ìŠ¤ í™œì„±í™”
                for(let i=1; i<=4; i++) {
                    const t = document.getElementById(`t-${i}`);
                    t.innerText = "ğŸ‘€"; // í•™ìƒ ìª½ì„ ë´„
                    t.classList.add('watching');
                }
                
                // 2ì´ˆ í›„ ë‹¤ì‹œ ë’¤ë¡œ ëŒì•„ê°
                setTimeout(() => {
                    isTeacherWatching = false;
                    for(let i=1; i<=4; i++) {
                        const t = document.getElementById(`t-${i}`);
                        t.innerText = "ğŸ‘¨â€ğŸ«"; // ì¹ íŒ ë´„
                        t.classList.remove('watching');
                    }
                    scheduleTeacher(); // ë‹¤ìŒ ì£¼ê¸° ì˜ˆì•½
                }, 2000);
            } else {
                scheduleTeacher();
            }
        }, 18000); // 18ì´ˆ ëŒ€ê¸° + 2ì´ˆ ê°ì‹œ = 20ì´ˆ ì£¼ê¸°
    }

    function setupInput(id) {
        const input = document.getElementById(`in-${id}`);
        input.addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                const val = input.value.trim();
                const team = document.getElementById(`mon-${id}`).classList.contains('red-mon') ? 'red' : 'blue';
                
                if(isTeacherWatching) {
                    // ê°ì  ì²˜ë¦¬
                    if(teamLog[team].length > 0) {
                        const lost = teamLog[team].pop();
                        for(let j=1; j<=4; j++) document.getElementById(`c-${j}-${lost}`).className = 'card';
                    }
                } else if(catWords.includes(val)) {
                    for(let j=1; j<=4; j++) document.getElementById(`c-${j}-${val}`).className = `card ${team}`;
                    if(!teamLog[team].includes(val)) teamLog[team].push(val);
                }
                input.value = '';
            }
        });
    }

    function startBonus() {
        isBonus = true;
        isTeacherWatching = false; // ë³´ë„ˆìŠ¤ ì¤‘ì—” ì„ ìƒë‹˜ ì•ˆ ë´„
        for(let i=1; i<=4; i++) document.getElementById(`t-${i}`).style.display = 'none';
        
        document.getElementById('game-grid').style.opacity = "0.2";
        const m = document.getElementById('bonus-modal');
        m.style.display = 'flex';
        const q = bonusSentences[Math.floor(Math.random()*bonusSentences.length)];
        document.getElementById('bonus-q').innerText = q;
        document.getElementById('bonus-in').focus();
    }

    function setupBonus() {
        const bIn = document.getElementById('bonus-in');
        bIn.addEventListener('keydown', (e) => {
            if(e.key === 'Enter' && isBonus) {
                if(bIn.value.trim() === document.getElementById('bonus-q').innerText) {
                    awardBonus(lastTeam);
                    finishGame();
                }
            }
        });
    }

    function awardBonus(team) {
        let count = 0;
        let shuffled = [...catWords].sort(() => Math.random() - 0.5);
        for(let w of shuffled) {
            if(count >= 4) break;
            for(let j=1; j<=4; j++) document.getElementById(`c-${j}-${w}`).className = `card ${team}`;
            count++;
        }
    }

    function finishGame() {
        const r = document.querySelectorAll('#b-1 .card.red').length;
        const b = document.querySelectorAll('#b-1 .card.blue').length;
        const winner = r > b ? "ë¹¨ê°•íŒ€" : "íŒŒë‘íŒ€";
        alert(`ìˆ˜ì—… ë!\nìµœì¢… ê²°ê³¼ - ë¹¨ê°•: ${r} vs íŒŒë‘: ${b}\n\nê²°êµ­ ${winner} ìŠ¹ë¦¬! ì§„ íŒ€ì€ í•™êµ ì• ì»µë–¡ë³¶ì´ ì´ë¼!`);
        location.reload();
    }

    init();
</script>
</body>
</html>
