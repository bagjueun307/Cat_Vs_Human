<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CAT PAN FLIP: SIMULTANEOUS V6</title>
    <link href="https://fonts.googleapis.com/css2?family=DungGeunMo&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: white; font-family: 'DungGeunMo', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #header { width: 100%; padding: 10px; background: #111; display: flex; flex-direction: column; align-items: center; border-bottom: 2px solid #444; }
        .time-container { width: 90%; height: 15px; background: #333; border-radius: 10px; margin: 5px 0; overflow: hidden; }
        #time-bar { width: 100%; height: 100%; background: #00ff00; transition: width 0.1s linear; }

        /* 4개 모니터 그리드 */
        #game-grid { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; width: 100vw; height: 85vh; gap: 5px; padding: 5px; box-sizing: border-box; }
        .monitor { position: relative; border: 6px solid; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .red-mon { border-color: #e74c3c; background: #2c0b0a; }
        .blue-mon { border-color: #3498db; background: #0a172c; }

        /* 보드 및 카드 */
        .board { display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px; padding: 5px; }
        .card { width: 60px; height: 35px; background: #444; color: #888; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 0.7rem; transition: 0.2s; box-shadow: 0 2px 0 #000; }
        .card.red { background: #e74c3c; color: white; box-shadow: 0 2px 0 #962d22; transform: scale(1.02); }
        .card.blue { background: #3498db; color: white; box-shadow: 0 2px 0 #2471a3; transform: scale(1.02); }

        /* 입력 시스템 */
        .input-wrap { margin-top: 10px; width: 80%; display: flex; flex-direction: column; align-items: center; }
        input { width: 100%; padding: 10px; font-family: 'DungGeunMo'; font-size: 1.1rem; text-align: center; border-radius: 6px; border: 3px solid #777; outline: none; background: #fff; color: #000; }
        .err-pop { position: absolute; color: #ff0; font-size: 1.5rem; display: none; z-index: 10; text-shadow: 2px 2px #000; pointer-events: none; }

        /* 보너스 모드 전용 UI */
        .bonus-mode input { border-color: #f1c40f; background: #fffde7; animation: pulse 1s infinite; }
        .bonus-label { color: #f1c40f; font-weight: bold; margin-bottom: 5px; display: none; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(241, 196, 15, 0); } 100% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0); } }

        #swap-msg { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #f1c40f; color: #000; padding: 20px 40px; border-radius: 50px; font-size: 2.5rem; display: none; z-index: 1000; border: 5px solid #000; }
    </style>
</head>
<body>

<div id="header">
    <div id="timer-text" style="font-size: 1.5rem;">READY...</div>
    <div class="time-container"><div id="time-bar"></div></div>
</div>

<div id="swap-msg">위치 셔플!!!</div>

<div id="game-grid">
    <div id="mon1" class="monitor red-mon" style="order:1;">
        <div class="bonus-label">⚡보너스 라운드!⚡</div>
        <div id="b1" class="board"></div>
        <div class="input-wrap">
            <div id="err1" class="err-pop">틀림!</div>
            <input type="text" id="in1" placeholder="RED TEAM 1">
        </div>
    </div>
    <div id="mon2" class="monitor blue-mon" style="order:2;">
        <div class="bonus-label">⚡보너스 라운드!⚡</div>
        <div id="b2" class="board"></div>
        <div class="input-wrap">
            <div id="err2" class="err-pop">틀림!</div>
            <input type="text" id="in2" placeholder="BLUE TEAM 1">
        </div>
    </div>
    <div id="mon3" class="monitor red-mon" style="order:3;">
        <div class="bonus-label">⚡보너스 라운드!⚡</div>
        <div id="b3" class="board"></div>
        <div class="input-wrap">
            <div id="err3" class="err-pop">틀림!</div>
            <input type="text" id="in3" placeholder="RED TEAM 2">
        </div>
    </div>
    <div id="mon4" class="monitor blue-mon" style="order:4;">
        <div class="bonus-label">⚡보너스 라운드!⚡</div>
        <div id="b4" class="board"></div>
        <div class="input-wrap">
            <div id="err4" class="err-pop">틀림!</div>
            <input type="text" id="in4" placeholder="BLUE TEAM 2">
        </div>
    </div>
</div>

<script>
    const catWords = ["고양이", "야옹이", "츄르", "젤리", "꾹꾹이", "골골송", "집사", "모래", "사료", "캣타워", "수염", "그루밍", "냥냥펀치", "꼬리", "낮잠", "햇살", "스크래쳐", "캣잎", "방울", "삼색이", "치즈", "고등어", "샴", "러블", "망토", "발바닥", "하악질", "개냥이", "사냥", "생선", "우유", "박스", "낚시", "무릎냥", "털공", "털갈이", "하품", "창밖", "숨바꼭질", "코인사"];
    const bonusSentences = ["우리 고양이는 츄르보다 집사의 무릎을 더 좋아합니다", "세상 모든 고양이가 아프지 않고 행복했으면 좋겠습니다", "꾹꾹이하는 발바닥 젤리는 세상에서 가장 말랑말랑합니다"];

    let timeLeft = 400;
    let gameActive = true;
    let isBonusMode = false;
    let currentBonusText = "";

    function createBoards() {
        for(let i=1; i<=4; i++) {
            const b = document.getElementById(`b${i}`);
            b.innerHTML = '';
            catWords.forEach(w => {
                const c = document.createElement('div');
                c.className = 'card'; c.innerText = w; c.id = `card-${i}-${w}`;
                b.appendChild(c);
            });
        }
    }

    // 게임 루프 및 타이머
    const gameTimer = setInterval(() => {
        if(!gameActive) return;
        timeLeft--;
        document.getElementById('time-bar').style.width = (timeLeft/400)*100 + "%";
        document.getElementById('timer-text').innerText = isBonusMode ? "BONUS TIME!" : (timeLeft/10).toFixed(1) + "s";
        
        if(timeLeft <= 0) {
            if(!isBonusMode) startBonusRound();
            else endBonusRound();
        }
    }, 100);

    // 10초마다 위치 셔플
    setInterval(() => {
        if(!gameActive) return;
        const msg = document.getElementById('swap-msg');
        msg.style.display = 'block';
        setTimeout(() => msg.style.display = 'none', 1000);
        
        const orders = [1, 2, 3, 4].sort(() => Math.random() - 0.5);
        for(let i=1; i<=4; i++) document.getElementById(`mon${i}`).style.order = orders[i-1];
    }, 10000);

    function startBonusRound() {
        isBonusMode = true;
        timeLeft = 150; // 보너스 시간 15초
        currentBonusText = bonusSentences[Math.floor(Math.random() * bonusSentences.length)];
        
        for(let i=1; i<=4; i++) {
            const mon = document.getElementById(`mon${i}`);
            mon.classList.add('bonus-mode');
            mon.querySelector('.bonus-label').style.display = 'block';
            mon.querySelector('.bonus-label').innerText = `[보너스 문장]: ${currentBonusText}`;
            document.getElementById(`in${i}`).value = '';
            document.getElementById(`in${i}`).placeholder = "문장을 빠르게 입력하세요!";
        }
    }

    function endBonusRound() {
        isBonusMode = false;
        timeLeft = 400; // 다시 본 게임 40초
        for(let i=1; i<=4; i++) {
            const mon = document.getElementById(`mon${i}`);
            mon.classList.remove('bonus-mode');
            mon.querySelector('.bonus-label').style.display = 'none';
            document.getElementById(`in${i}`).value = '';
            const team = mon.classList.contains('red-mon') ? 'RED' : 'BLUE';
            document.getElementById(`in${i}`).placeholder = `${team} TEAM`;
        }
    }

    function handleInput(i) {
        const input = document.getElementById(`in${i}`);
        input.addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                const val = input.value.trim();
                const mon = document.getElementById(`mon${i}`);
                const team = mon.classList.contains('red-mon') ? 'red' : 'blue';

                if(isBonusMode) {
                    if(val === currentBonusText) {
                        alert(`${team.toUpperCase()} 팀 보너스 성공! 카드 4장을 획득합니다!`);
                        applyBonus(team);
                        endBonusRound();
                    }
                } else {
                    if(catWords.includes(val)) {
                        for(let j=1; j<=4; j++) document.getElementById(`card-${j}-${val}`).className = `card ${team}`;
                    } else {
                        const err = document.getElementById(`err${i}`);
                        err.style.display = 'block'; setTimeout(() => err.style.display = 'none', 600);
                    }
                }
                input.value = '';
            }
        });
    }

    function applyBonus(team) {
        let count = 0;
        let shuffled = [...catWords].sort(() => Math.random() - 0.5);
        for(let w of shuffled) {
            if(count >= 4) break;
            const target = document.getElementById(`card-1-${w}`);
            if(!target.classList.contains(team)) {
                for(let j=1; j<=4; j++) document.getElementById(`card-${j}-${w}`).className = `card ${team}`;
                count++;
            }
        }
    }

    createBoards();
    for(let i=1; i<=4; i++) handleInput(i);
</script>
</body>
</html>
