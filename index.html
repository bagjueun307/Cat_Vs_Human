<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì´ˆë“±í•™êµ ì»´í“¨í„°ì‹¤ ë©€í‹°í”Œë ˆì´ V25</title>
    <link href="https://fonts.googleapis.com/css2?family=DungGeunMo&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #00ff00; font-family: 'DungGeunMo', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        
        /* ë¡œë¹„ í™”ë©´ */
        #lobby { position: fixed; inset: 0; background: #111; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
        .lobby-title { font-size: 2.5rem; color: #f1c40f; margin-bottom: 30px; }
        .monitor-btn { width: 150px; height: 80px; font-family: 'DungGeunMo'; font-size: 1.1rem; cursor: pointer; margin: 10px; background: #333; color: white; border: 4px outset #888; }
        .monitor-btn:hover { background: #444; border-color: #0ff; }
        .start-trigger { margin-top: 30px; padding: 15px 40px; font-size: 1.5rem; background: #f1c40f; color: #000; cursor: pointer; border: none; font-family: 'DungGeunMo'; }

        /* ê²Œì„ ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        #game-container { display: none; flex-direction: column; align-items: center; width: 100vw; height: 100vh; padding: 20px; box-sizing: border-box; }
        #header { width: 100%; max-width: 1000px; display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; }
        
        /* íŒ€ ì ìˆ˜íŒ */
        #score-board { display: flex; gap: 40px; font-size: 2rem; margin-bottom: 10px; }
        .score.red { color: #e74c3c; text-shadow: 0 0 10px rgba(231, 76, 60, 0.5); }
        .score.blue { color: #3498db; text-shadow: 0 0 10px rgba(52, 152, 219, 0.5); }

        .time-bar-bg { width: 100%; height: 20px; background: #111; border: 2px inset #555; position: relative; }
        #time-bar { width: 100%; height: 100%; background: #00ff00; transition: width 0.1s linear; }

        /* ì„ ìƒë‹˜ê³¼ ë‹¨ì¼ ëª¨ë‹ˆí„° í™”ë©´ */
        .stage { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        .teacher-box { width: 120px; height: 90px; font-size: 4rem; display: flex; justify-content: center; align-items: center; background: #333; border: 5px solid #555; border-radius: 15px 15px 0 0; margin-bottom: -5px; z-index: 10; }
        .teacher-box.watching { background: #ff0000; animation: shake 0.1s infinite; }

        .monitor-frame { width: 100%; max-width: 900px; border: 12px outset #aaa; background: #000; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; }
        .monitor-frame.red-team { border-color: #e74c3c; }
        .monitor-frame.blue-team { border-color: #3498db; }

        .board { display: grid; grid-template-columns: repeat(8, 1fr); gap: 6px; flex: 1; }
        .card { height: 35px; background: #222; color: #444; font-size: 0.8rem; display: flex; justify-content: center; align-items: center; border-radius: 4px; text-align: center; border: 1px solid #333; }
        .card.red { background: #e74c3c; color: white; box-shadow: inset -3px -3px 0 #962d22; border: none; }
        .card.blue { background: #3498db; color: white; box-shadow: inset -3px -3px 0 #2471a3; border: none; }

        .input-area { margin-top: 20px; width: 100%; }
        #player-input { width: 100%; padding: 15px; font-family: 'DungGeunMo'; font-size: 1.8rem; background: #000; color: #fff; border: 4px solid #555; outline: none; text-align: center; }
        #player-input.caught { border-color: red; background: #400; }

        @keyframes shake { 0% { transform: translateY(-2px); } 100% { transform: translateY(2px); } }
    </style>
</head>
<body>

<div id="lobby">
    <h1 class="lobby-title">ì´ˆë“±í•™êµ ì»´í“¨í„°ì‹¤ ëŒ€ê²°</h1>
    <div>
        <button class="monitor-btn" onclick="assignPos(1)">ëª¨ë‹ˆí„° 1</button>
        <button class="monitor-btn" onclick="assignPos(2)">ëª¨ë‹ˆí„° 2</button>
        <button class="monitor-btn" onclick="assignPos(3)">ëª¨ë‹ˆí„° 3</button>
        <button class="monitor-btn" onclick="assignPos(4)">ëª¨ë‹ˆí„° 4</button>
    </div>
    <button id="btn-start" class="start-trigger" onclick="broadcastStart()" style="display:none;">ìˆ˜ì—… ì‹œì‘! (ì „ì²´ ë™ê¸°í™”)</button>
    <p id="status-msg" style="color: #666; margin-top: 20px;">ìì‹ ì˜ ìë¦¬ë¥¼ ì„ íƒí•˜ê³  ëŒ€ê¸°í•˜ì„¸ìš”.</p>
</div>

<div id="game-container">
    <div id="header">
        <div id="score-board">
            <div class="score red">RED: <span id="score-red">0</span></div>
            <div style="color: #fff;">VS</div>
            <div class="score blue">BLUE: <span id="score-blue">0</span></div>
        </div>
        <div id="timer-text" style="font-size:1.5rem;">ë‚¨ì€ ìˆ˜ì—… ì‹œê°„: 300.0s</div>
        <div class="time-bar-bg"><div id="time-bar"></div></div>
    </div>

    <div class="stage">
        <div id="teacher" class="teacher-box">ğŸ‘¨â€ğŸ«</div>
        <div id="my-monitor" class="monitor-frame">
            <div id="main-board" class="board"></div>
            <div class="input-area">
                <input type="text" id="player-input" placeholder="ì—¬ê¸°ì— ë‹¨ì–´ë¥¼ ì¹˜ì„¸ìš”!">
            </div>
        </div>
        <div id="pos-info" style="margin-top: 20px; color: #f1c40f; font-size: 1.2rem;"></div>
    </div>
</div>

<script>
    const schoolWords = ["ë–¡ë³¶ì´", "ê¸‰ì‹", "ìš´ë™ì¥", "ë°›ì•„ì“°ê¸°", "ë°©í•™", "ìš°ìœ ê¸‰ì‹", "ì•Œë¦¼ì¥", "ì§ê¿", "ì¤€ë¹„ë¬¼", "ì‹¤ë‚´í™”", "ìƒ‰ì¢…ì´", "ë”±ì§€", "ìŠ¬ëŸ¬ì‹œ", "í”¼ì¹´ì¸„", "í•™ì›", "ìˆ™ì œ", "ì²´ìœ¡", "ì†Œí’", "ì‰¬ëŠ”ì‹œê°„", "ì§€ìš°ê°œ", "í•„í†µ", "ì‹¤ë¡œí°", "ë¦¬ì½”ë”", "ë°˜ì¥", "ì¼ê¸°", "ë…ì„œ", "í”¼êµ¬", "íƒœê¶Œë„", "ë¬¸ë°©êµ¬", "ë½‘ê¸°", "ë¶„ì‹ì§‘", "êµì‹¤", "ëª¨ë‘ í™œë™", "êµì¥ì„ ìƒë‹˜", "ìš´ë™íšŒ", "ë§¤ì ", "ì¹ íŒ", "ë¶„í•„", "ì‹¤ë‚´í™”ê°€ë°©", "ì •ë¬¸"];

    let myPos = 0;
    let myTeam = '';
    let gameActive = false;
    let isTeacherWatching = false;

    // ì´ˆê¸°í™”: ë‹¤ë¥¸ ì°½ë“¤ê³¼ ë°ì´í„°ë¥¼ ë§ì¶”ê¸° ìœ„í•´ ì´ˆê¸° ìƒíƒœ ì„¤ì •
    if(!localStorage.getItem('game_state')) {
        localStorage.setItem('game_state', JSON.stringify({cards: {}, redScore: 0, blueScore: 0}));
    }

    function assignPos(num) {
        myPos = num;
        myTeam = (num === 1 || num === 3) ? 'red' : 'blue';
        document.getElementById('status-msg').innerText = `${num}ë²ˆ ìë¦¬ ì„ íƒë¨! (íŒ€: ${myTeam.toUpperCase()})`;
        document.getElementById('btn-start').style.display = 'inline-block';
        document.getElementById('pos-info').innerText = `ë‚´ ìœ„ì¹˜: ${num}ë²ˆ ëª¨ë‹ˆí„° / íŒ€: ${myTeam.toUpperCase()}`;
        
        const frame = document.getElementById('my-monitor');
        frame.classList.add(myTeam === 'red' ? 'red-team' : 'blue-team');
    }

    function broadcastStart() {
        localStorage.setItem('game_command', 'START_' + Date.now());
        runGame();
    }

    window.addEventListener('storage', (e) => {
        // 1. ì‹œì‘ ì‹ í˜¸ ë™ê¸°í™”
        if (e.key === 'game_command' && e.newValue.startsWith('START')) {
            if (!gameActive) runGame();
        }
        // 2. ì¹´ë“œ/ì ìˆ˜ ìƒíƒœ ì‹¤ì‹œê°„ ë™ê¸°í™”
        if (e.key === 'game_state') {
            syncUI();
        }
    });

    function runGame() {
        if (gameActive) return;
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('game-container').style.display = 'flex';
        
        buildBoard();
        gameActive = true;

        let timeLeft = 3000;
        const timer = setInterval(() => {
            timeLeft--;
            document.getElementById('time-bar').style.width = (timeLeft / 3000) * 100 + "%";
            document.getElementById('timer-text').innerText = `ë‚¨ì€ ìˆ˜ì—… ì‹œê°„: ${(timeLeft / 10).toFixed(1)}s`;

            // ëª¨ë“  ì°½ì˜ ì„ ìƒë‹˜ì´ ë˜‘ê°™ì´ ì›€ì§ì„ (ì‹œê°„ ê¸°ë°˜)
            const cycle = timeLeft % 200;
            if (cycle <= 20) {
                isTeacherWatching = true;
                document.getElementById('teacher').classList.add('watching');
                document.getElementById('teacher').innerText = "ğŸ‘€";
            } else {
                isTeacherWatching = false;
                document.getElementById('teacher').classList.remove('watching');
                document.getElementById('teacher').innerText = "ğŸ‘¨â€ğŸ«";
            }

            if (timeLeft <= 0) {
                clearInterval(timer);
                endGame();
            }
        }, 100);

        handleInput();
    }

    function buildBoard() {
        const board = document.getElementById('main-board');
        board.innerHTML = '';
        schoolWords.forEach(w => {
            const c = document.createElement('div');
            c.className = 'card';
            c.innerText = w;
            c.id = `card-${w}`;
            board.appendChild(c);
        });
        syncUI(); // ì´ˆê¸° ìƒíƒœ ë°˜ì˜
    }

    function handleInput() {
        const input = document.getElementById('player-input');
        input.focus();
        input.addEventListener('keydown', (e) => {
            if (isTeacherWatching) {
                input.classList.add('caught');
                setTimeout(() => input.classList.remove('caught'), 500);
                
                // ê±¸ë¦¬ë©´ ìš°ë¦¬ íŒ€ ì¹´ë“œ í•˜ë‚˜ê°€ ì¤‘ë¦½ìœ¼ë¡œ ëŒì•„ê° (ì‹¤ì‹œê°„ ë°˜ì˜)
                let state = JSON.parse(localStorage.getItem('game_state'));
                let myCards = schoolWords.filter(w => state.cards[w] === myTeam);
                if (myCards.length > 0) {
                    delete state.cards[myCards[Math.floor(Math.random() * myCards.length)]];
                    pushUpdate(state);
                }
                input.value = '';
                e.preventDefault();
                return;
            }

            if (e.key === 'Enter') {
                const val = input.value.trim();
                let state = JSON.parse(localStorage.getItem('game_state'));
                if (schoolWords.includes(val) && !state.cards[val]) {
                    state.cards[val] = myTeam;
                    pushUpdate(state);
                }
                input.value = '';
            }
        });
    }

    function pushUpdate(state) {
        state.redScore = schoolWords.filter(w => state.cards[w] === 'red').length;
        state.blueScore = schoolWords.filter(w => state.cards[w] === 'blue').length;
        localStorage.setItem('game_state', JSON.stringify(state));
        syncUI(); // ë‚´ í™”ë©´ ì¦‰ì‹œ ê°±ì‹ 
    }

    function syncUI() {
        const state = JSON.parse(localStorage.getItem('game_state'));
        document.getElementById('score-red').innerText = state.redScore;
        document.getElementById('score-blue').innerText = state.blueScore;

        schoolWords.forEach(w => {
            const card = document.getElementById(`card-${w}`);
            if(card) {
                card.className = 'card' + (state.cards[w] ? ' ' + state.cards[w] : '');
            }
        });
    }

    function endGame() {
        gameActive = false;
        const state = JSON.parse(localStorage.getItem('game_state'));
        alert(`ìˆ˜ì—… ì¢…ë£Œ!\nìµœì¢… ìŠ¤ì½”ì–´ - REDíŒ€: ${state.redScore} : BLUEíŒ€: ${state.blueScore}`);
        localStorage.removeItem('game_state');
        localStorage.removeItem('game_command');
        location.reload();
    }
</script>
</body>
</html>
