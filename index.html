<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CAT vs HUMAN: PERFECT GRID SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=DungGeunMo&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #000; 
            --human-main: #2980b9; --human-bg: #d6eaf8;
            --cat-main: #d35400; --cat-bg: #fbeee6;
            --dark: #2c3e50; --fail: #c0392b; --success: #27ae60;
        }
        body { background: var(--bg); color: white; font-family: 'DungGeunMo', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        
        #header { background: #1a1a1a; width: 100%; padding: 5px 0; text-align: center; border-bottom: 2px solid #333; font-size: 0.8rem; }
        #game-board { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; width: 100vw; height: 94vh; gap: 6px; padding: 6px; box-sizing: border-box; }
        
        .monitor { position: relative; border: 5px solid; display: flex; flex-direction: column; padding: 8px; transition: 0.3s; box-sizing: border-box; }
        .monitor.human-zone { background: var(--human-bg); border-color: var(--human-main); color: var(--dark); }
        .monitor.cat-zone { background: var(--cat-bg); border-color: var(--cat-main); color: var(--dark); }

        /* í‘ë°± íŒ¨ë„í‹° ìƒíƒœ */
        .monitor.locked { filter: grayscale(1) brightness(0.4); pointer-events: none; }
        .monitor.locked::after { content: "ì˜¤ë‹µ! 5ì´ˆ ëŒ€ê¸°"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ff7675; font-size: 1.5rem; text-align: center; z-index: 100; text-shadow: 2px 2px #000; width: 100%; }

        .m-timer-wrapper { width: 100%; height: 6px; background: #bbb; margin-bottom: 5px; }
        .m-timer-fill { width: 100%; height: 100%; background: #444; transition: width 0.1s linear; }

        .tag { position: absolute; top: 8px; right: 8px; padding: 1px 6px; font-size: 0.7rem; color: white; border-radius: 3px; }
        .human-zone .tag { background: var(--human-main); }
        .cat-zone .tag { background: var(--cat-main); }

        .content-area { width: 100%; height: 35%; background: white; border: 2px solid #333; display: flex; justify-content: center; align-items: center; overflow: hidden; margin-bottom: 5px; }
        img, video { max-width: 100%; max-height: 100%; object-fit: contain; }

        /* 4x4 ì™„ë²½ ê²©ì í‚¤íŒ¨ë“œ */
        .button-pad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 3px; width: 160px; margin: 0 auto; }
        .num-btn { 
            aspect-ratio: 1/1; background: white; border: 2px solid #333; 
            font-family: 'DungGeunMo'; font-size: 0.9rem; cursor: pointer;
            box-shadow: 0 2px 0 #999;
        }
        .num-btn:active { transform: translateY(1px); box-shadow: 0 0px 0 #999; }
        .num-btn.selected { background: #333 !important; color: white !important; }
        
        .control-row { display: flex; gap: 4px; width: 160px; margin: 4px auto; }
        .ok-btn { flex: 2; height: 30px; background: #333; color: white; border: none; font-family: 'DungGeunMo'; cursor: pointer; font-size: 0.8rem; }
        .audio-btn { flex: 1; height: 30px; background: #555; color: white; border: none; font-family: 'DungGeunMo'; cursor: pointer; font-size: 0.6rem; }

        .overlay-msg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; font-size: 2.5rem; font-weight: bold; z-index: 50; pointer-events: none; text-shadow: 3px 3px #000; }
    </style>
</head>
<body>

<div id="header">[ CAT vs HUMAN ] SYSTEM V10</div>
<div id="game-board">
    <div id="m0" class="monitor"></div>
    <div id="m1" class="monitor"></div>
    <div id="m2" class="monitor"></div>
    <div id="m3" class="monitor"></div>
</div>

<script>
    const raw = (url) => url.replace("github.com", "raw.githubusercontent.com").replace("/blob/", "/");

    const problemDB = [
        { type: 'human', q: "[ë³´ê¸°] ê³ ì–‘ì´ê°€ ëª‡ ë²ˆ ë•Œë¦¬ë‚˜ìš”?", a: "ì •ë‹µ", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EB%B3%B4%EA%B8%B0%EB%AC%B8%EC%A0%9C1.JPG"), video: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EB%B3%B4%EA%B8%B0%20%EB%AC%B8%EC%A0%9C%201%EB%B2%88%20%EB%95%8C%EB%A6%AC%EB%8A%94%20%EA%B3%A0%EC%96%91%EC%9D%B4.mp4"), multi: false },
        { type: 'human', q: "í˜ë¥´ì‹œì•ˆ ê³ ì–‘ì´ë¥¼ ê³ ë¥´ì„¸ìš”.", a: "1", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/1.JPG"), multi: false },
        { type: 'human', q: "ì¸„ë¥´(í™©íƒœ)ë¥¼ ê³ ë¥´ì„¸ìš”.", a: "2", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/2.JPG"), multi: false },
        { type: 'cat', q: "ëª‡ ì‹œ ì¸ì§€ ë§ì¶”ì„¸ìš”.", a: "9", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/3.JPG"), multi: false },
        { type: 'human', q: "ê³ ì–‘ì´ê°€ ì•„ë‹Œ ê²ƒì„ ëˆ„ë¥´ì„¸ìš”.", a: "ì •ë‹µ", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/4.JPG"), multi: false },
        { type: 'human', q: "í‹€ë¦° ê³³ì€ ì´ ëª‡ êµ°ë°?", a: "3", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/5.JPG"), multi: false },
        { type: 'human', q: "ê³ ì–‘ì´ ì¹¸ ë²ˆí˜¸ë¥¼ ëª¨ë‘ ëˆ„ë¥´ì„¸ìš”.", a: "135", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/6.JPG"), multi: true },
        { type: 'human', q: "ìˆ¨ì€ ê³ ì–‘ì´ ì¹¸ì„ ëª¨ë‘ ëˆ„ë¥´ì„¸ìš”.", a: "24", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/7.JPG"), multi: true },
        { type: 'human', q: "ì•„ê¸° ìƒ´ ê³ ì–‘ì´ë¥¼ ê³ ë¥´ì„¸ìš”.", a: "3", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/8.JPG"), multi: false },
        { type: 'cat', q: "ê³ ì–‘ì´ê°€ ìˆë˜ ìœ„ì¹˜ ê°œìˆ˜ëŠ”?", a: "3", img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/9.JPG"), multi: false },
        { type: 'cat', q: "ë“£ê¸° 1: ì†Œë¦¬ë¥¼ ë“£ê³  ì •ë‹µ í™•ì¸!", a: "ì •ë‹µ", audio: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EA%B3%A0%EC%96%91%EC%9D%B4%20%EB%82%98%EA%B1%B0%EB%9E%98%20%EB%93%A3%EA%B8%B0%20%EB%AC%B8%EC%A0%9C%201%EB%B2%88.m4a"), img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EB%93%A3%EA%B8%B0%EB%AC%B8%EC%A0%9C1.JPG"), multi: false },
        { type: 'cat', q: "ë“£ê¸° 2: ê±°ê¾¸ë¡œ ë§í•œ ë¬¸ì¥ì€?", a: "ì •ë‹µ", audio: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EA%B3%A0%EC%96%91%EC%9D%B4%20%ED%95%9C%EA%B5%AD%EB%A7%90%EC%9D%84%20%EC%95%8C%EC%95%84%EC%9A%94%20%EB%93%A3%EA%B8%B0%20%EB%AC%B8%EC%A0%9C%202%EB%B2%88.m4a"), img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EB%93%A3%EA%B8%B0%EB%AC%B8%EC%A0%9C2.JPG"), multi: false },
        { type: 'cat', q: "ë“£ê¸° 3: ì‚¬ì˜¤ë¼ê³  í•œ ìŒì‹ì€?", a: "ì •ë‹µ", audio: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EB%93%A3%EA%B8%B0%20%EB%AC%B8%EC%A0%9C%203%EB%B2%88%20%EC%98%A4%EC%A7%95%EC%96%B4.m4a"), img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EB%93%A3%EA%B8%B0%EB%AC%B8%EC%A0%9C3.JPG"), multi: false },
        { type: 'cat', q: "ë“£ê¸° 4: ì‚¬ì˜¤ì§€ ë§ë¼ëŠ” ìŒì‹ì€?", a: "ì •ë‹µ", audio: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EB%93%A3%EA%B8%B0%20%EB%AC%B8%EC%A0%9C%204%EB%B2%88%20%EC%83%9D%EA%B0%81%20%EC%82%AC%EC%98%A4%EC%A7%80%20%EB%A7%88%EC%84%B8%EC%9A%94.m4a"), img: raw("https://github.com/bagjueun307/Cat_Vs_Human/blob/main/%EB%93%A3%EA%B8%B0%EB%AC%B8%EC%A0%9C4.JPG"), multi: false }
    ];

    let monitorStates = [
        { time: 100, locked: false, selected: "", currentP: null },
        { time: 100, locked: false, selected: "", currentP: null },
        { time: 100, locked: false, selected: "", currentP: null },
        { time: 100, locked: false, selected: "", currentP: null }
    ];

    function setProblem(idx) {
        const m = document.getElementById(`m${idx}`);
        const p = problemDB[Math.floor(Math.random() * problemDB.length)];
        monitorStates[idx].currentP = p;
        monitorStates[idx].selected = "";
        monitorStates[idx].time = 100;
        
        const isH = p.type === 'human';
        m.className = `monitor ${isH ? 'human-zone' : 'cat-zone'}`;
        let visual = p.video ? `<video src="${p.video}" autoplay loop muted playsinline></video>` : `<img src="${p.img}">`;
        
        m.innerHTML = `
            <div class="overlay-msg" id="ov-${idx}"></div>
            <div class="m-timer-wrapper"><div class="m-timer-fill" id="tfill-${idx}"></div></div>
            <div class="tag">${isH ? 'ì¸ê°„' : 'ê³ ì–‘ì´'}</div>
            <div style="font-size:0.7rem; text-align:center; height:1.2rem; font-weight:bold;">${p.q}</div>
            <div class="content-area">${visual}</div>
            <div class="button-pad">
                ${Array.from({length: 16}, (_, i) => i + 1).map(n => `<button class="num-btn" id="btn-${idx}-${n}" onclick="btnPush(${idx}, '${n}')">${n}</button>`).join('')}
            </div>
            <div class="control-row">
                ${p.audio ? `<button class="audio-btn" onclick="new Audio('${p.audio}').play()">ğŸµ ë“£ê¸°</button>` : '<div style="flex:1"></div>'}
                <button class="ok-btn" onclick="btnPush(${idx}, 'OK')">í™•ì¸ (OK)</button>
            </div>
        `;
    }

    function btnPush(idx, val) {
        if (monitorStates[idx].locked) return;
        const p = monitorStates[idx].currentP;

        if (p.multi) {
            if (val === 'OK') checkFinal(idx, monitorStates[idx].selected, p.a);
            else if (!monitorStates[idx].selected.includes(val)) {
                monitorStates[idx].selected += val;
                document.getElementById(`btn-${idx}-${val}`).classList.add('selected');
            }
        } else {
            if (val === 'OK') checkFinal(idx, "ì •ë‹µ", p.a);
            else checkFinal(idx, val, p.a);
        }
    }

    function checkFinal(idx, val, correct) {
        const ov = document.getElementById(`ov-${idx}`);
        const sVal = val.split('').sort().join('');
        const sCor = correct.split('').sort().join('');

        if (val === correct || (val !== "" && sVal === sCor) || correct === "ì •ë‹µ") {
            ov.innerText = "ì •ë‹µ!"; ov.style.color = "#2ecc71";
            ov.style.display = "flex";
            monitorStates[idx].locked = true;
            // ì •ë‹µì´ë©´ 0.4ì´ˆë§Œ ë³´ì—¬ì£¼ê³  ì¦‰ì‹œ ë‹¤ìŒ ë¬¸ì œ
            setTimeout(() => {
                ov.style.display = "none";
                monitorStates[idx].locked = false;
                setProblem(idx);
            }, 400);
        } else {
            ov.innerText = "ì˜¤ë‹µ!"; ov.style.color = "#e74c3c";
            ov.style.display = "flex";
            applyPenalty(idx);
        }
    }

    function applyPenalty(idx) {
        const m = document.getElementById(`m${idx}`);
        monitorStates[idx].locked = true;
        m.classList.add('locked');
        setTimeout(() => {
            m.classList.remove('locked');
            document.getElementById(`ov-${idx}`).style.display = "none";
            monitorStates[idx].locked = false;
            setProblem(idx); // ì˜¤ë‹µ íŒ¨ë„í‹° í›„ ìƒˆë¡œìš´ ë¬¸ì œ
        }, 5000);
    }

    function updateTimers() {
        for(let i=0; i<4; i++) {
            if (!monitorStates[i].locked) {
                monitorStates[i].time -= 0.15;
                document.getElementById(`tfill-${i}`).style.width = monitorStates[i].time + "%";
                if (monitorStates[i].time <= 0) setProblem(i);
            }
        }
    }

    for(let i=0; i<4; i++) setProblem(i);
    setInterval(updateTimers, 20);
</script>
</body>
</html>
